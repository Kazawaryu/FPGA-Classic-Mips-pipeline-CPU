# Verilog Classic Mips pipeline CPU

[![vivado version](https://img.shields.io/badge/Vivado%20version-2017.4-brightgreen?style=flat-square)](https://img.shields.io/badge/Vivado%20version-2017.4-brightgreen?style=flat-square) [![mars version](https://img.shields.io/badge/Mars%20version-4.5-orange?style=flat-square)](https://img.shields.io/badge/Mars%20version-4.5-orange?style=flat-square) [![mars version](https://img.shields.io/badge/Code%20version-1.1-blue?style=flat-square)](https://img.shields.io/badge/Code%20version-1.1-blue?style=flat-square)

## ç›®å½•

- [é¡¹ç›®ä»‹ç»](#é¡¹ç›®ä»‹ç»)
- [å®‰è£…](#å®‰è£…)
- [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜)
- [ç¤ºä¾‹](#ç¤ºä¾‹)
- [ç›¸å…³ä»“åº“](#ç›¸å…³ä»“åº“)
- [ç»´æŠ¤è€…](#ç»´æŠ¤è€…)
- [å¦‚ä½•è´¡çŒ®](#å¦‚ä½•è´¡çŒ®)
- [ä½¿ç”¨è®¸å¯](#ä½¿ç”¨è®¸å¯)

## é¡¹ç›®ä»‹ç»

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª **Classic Mips pipeline CPU**ï¼Œç”± Verilog è¯­è¨€ç¼–å†™ï¼ŒMips æ±‡ç¼–å®ç°åœºæ™¯æµ‹è¯•ã€‚

- æ¶æ„ï¼šåŸºäºå†¯Â·è¯ºä¾æ›¼ä½“ç³»è®¾è®¡çš„å•å‘¨æœŸcpuï¼ˆCPI = 1ï¼‰ï¼Œé‡‡ç”¨ç»å…¸5çº§æµæ°´çº¿ï¼Œå†…ç½®32ä¸ªå¯„å­˜å™¨ï¼Œä½å®½ä¸º32bitsã€‚

- å¤–è®¾ï¼šé€šè¿‡LEDç¯ã€ä¸ƒæ®µæ•°ç æ˜¾ç¤ºç®¡ã€VGAåè®®æ˜¾ç¤ºè¿›è¡Œæ•°æ®å¯è§†åŒ–ï¼Œå¯»å€å•ä½ä¸º1byteã€‚ä½¿ç”¨èœ‚é¸£å™¨ï¼Œå¯ä»¥æ’­æ”¾å†…ç½®çš„ç”µå­éŸ³ä¹ã€‚

- æŒ‡ä»¤ï¼šæ”¯æŒçš„æŒ‡ä»¤é›†ä¸ºMinisys-1 ISAï¼Œé‡‡ç”¨UARTä¸²å£çƒ§å½•å®ç°è¾…åŠ©ç”¨æˆ·æµ‹è¯•ã€‚

### é¡¹ç›®æ¶æ„





### æ¨¡å—ç»†èŠ‚

#### æµæ°´çº¿æ¶æ„ä¸è®¾è®¡







#### å…¶ä»–é™„åŠ æ¨¡å—

##### VGAåè®®æ˜¾ç¤ºå™¨æ˜¾ç¤ºæ¨¡å—



##### èœ‚é¸£å™¨éŸ³ä¹æ¨¡å—

###### è®¾è®¡æ€è·¯

è¦è¾“å‡ºæŸä¸ªéŸ³ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å®ƒçš„é¢‘ç‡ï¼Œæ‚¨å¯ä»¥åœ¨ [MixButton](https://mixbutton.com/) è·å–åˆ°æ›´å¤šä¿¡æ¯ã€‚ å‡è®¾æˆ‘ä»¬è¦è¾“å‡ºä¸­éŸ³Cï¼ŒæŸ¥è¡¨å‘ç°å®ƒçš„é¢‘ç‡æ˜¯261.63Hzã€‚ æˆ‘ä»¬ä» 261.63Hz è®¡ç®—åŠå‘¨æœŸï¼Œå³ $191110 * 10^{-8}$ ç§’ï¼Œç„¶åæˆ‘ä»¬åªéœ€åœ¨ $191110 * 10^{-8}$ ç§’ååè½¬è¾“å‡ºèœ‚é¸£å™¨ã€‚

æˆ‘ä»¬å°†åŠå‘¨æœŸç¼–ç ä¸º period_code ä»¥é¿å…æ•°æ®å†—ä½™ã€‚

åŸºæœ¬æ€æƒ³æ˜¯å°†éŸ³ç¬¦è¡¨ç¤ºä¸ºå‘¨æœŸä»£ç ã€‚ ä½¿ç”¨å¤šè·¯å¤ç”¨å™¨é€‰æ‹©ç”±â€œIndexâ€ç´¢å¼•çš„å½“å‰å‘¨æœŸä»£ç ï¼Œå®ƒè¡¨ç¤ºå½“å‰æ­£åœ¨æ’­æ”¾å“ªä¸ªéŸ³ç¬¦ã€‚ ç´¢å¼•æ¯ 0.15 ç§’é€’å¢ 1ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªéŸ³ç¬¦åªä¼šæŒç»­ 0.15 ç§’ã€‚ å½“é€‰æ‹©å½“å‰å‘¨æœŸä»£ç æ—¶ï¼Œå®ƒè¢«ç¿»è¯‘æˆå®é™…çš„åŠå‘¨æœŸæ•°å¹¶è®©è¾“å‡ºèœ‚é¸£å™¨åœ¨åŠå‘¨æœŸååè½¬ã€‚

![buzzer.png](images/buzzer.png)

###### â€éŸ³ç¬¦â€”bitä¸²â€œè½¬æ¢è„šæœ¬

```C++
#include <iostream>
using namespace std;
int main(){
    string s = "131ef0fe101ef0fe1030ef0fe1012101f30" ;
    s = s + "ef0fe101ef0fe301ef0fe1012101310";
    s = s + "1012301e1012301e10e10e010e10e04310f03";
    	
    	......
            
    string out;
    for(int i = 0; i < s.length(); i ++){
        string tmp;
        switch(s[i]){
            case ('0') : tmp = "0000"; break;
                ......
            default : tmp = "0000";
        }
        out = tmp + out;
    }
    cout << s.size() * 4 << "\'b" << out << endl << s.size();
}
```



##### UARTä¸²å£çƒ§å½•æ¨¡å—



##### 7æ®µæ•°ç ç®¡





## å®‰è£…

1. è¿™ä¸ªé¡¹ç›®ä½¿ç”¨ [Vivado](https://www.xilinx.com/products/design-tools/vivado.html) å’Œ [Mars](http://courses.missouristate.edu/kenvollmar/mars/)ã€‚è¯·ç¡®ä¿ä½ æœ¬åœ°å®‰è£…äº†å®ƒä»¬ã€‚

2. å°†é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ã€‚

```sh
git clone https://github.com/Kazawaryu/Simple_CPU_in_FPGA
```

3. è¿è¡Œ **project.xpr** æ–‡ä»¶ã€‚
4. ç”Ÿæˆ **BitStream** æ–‡ä»¶ï¼Œå¹¶çƒ§å½•åˆ°æ‚¨çš„FPGAç¡¬ä»¶è®¾å¤‡ã€‚
5. é‡å¯æ‚¨çš„FPGAç¡¬ä»¶è®¾å¤‡ã€‚

## ä½¿ç”¨è¯´æ˜

### æŒ‰é”®è¯´æ˜

1. å¼€å¯CPUï¼š23å·å¼€å…³ç½®1ï¼Œå¼€å¯ä¿é™©ï¼Œè¿›å…¥mainçŠ¶æ€ã€‚
2. è¾“å…¥caseï¼šä¿®æ”¹18 - 16å·å¼€å…³ï¼Œ7æ®µæ•°ç ç®¡ä¼šåŒæ­¥æ›´æ–°æ‚¨çš„è¾“å…¥ã€‚
3. æäº¤caseï¼š21å·å¼€å…³ç½®1ï¼Œè·³è½¬åˆ°å¯¹åº”çš„caseï¼Œå¯¹äºä¸åŒçš„caseï¼Œå¯èƒ½ç”±ä¸åŒçš„è¾“å…¥éœ€æ±‚ã€‚
4. è¾“å…¥numï¼šä¿®æ”¹7 - 0å·å¼€å…³ï¼Œ7æ®µæ•°ç ç®¡ä¼šåŒæ­¥æ›´æ–°æ‚¨çš„è¾“å…¥ã€‚
5. æäº¤numï¼š20å·å¼€å…³ç½®1ï¼ŒCPUæ‰§è¡Œå¯¹åº”æ±‡ç¼–æŒ‡ä»¤ï¼Œ7æ®µæ•°ç ç®¡ä¼šæ˜¾ç¤ºå¯¹æ‚¨è¾“å…¥numçš„å¤„ç†ç»“æœã€‚
6. å›åˆ°mainï¼š21å·å¼€å…³ç½®0ï¼Œæ¨èæ‚¨åŒæ—¶å°†20å·å¼€å…³ç½®0ã€‚

| 23   | 22   | 21        | 20       | 19   | 18 - 16         | 15 - 8 | 7 - 0          |
| ---- | ---- | --------- | -------- | ---- | --------------- | ------ | -------------- |
| ä¿é™© | BGM  | Case æäº¤ | Num æäº¤ | None | 3bits Case è¾“å…¥ | None   | 8bits Num è¾“å…¥ |

### åœºæ™¯ä¸€

1. **Case 0** è¾“å…¥æµ‹è¯•æ•°aï¼Œè¾“å…¥å®Œæ¯•ååœ¨ledç¯ä¸Šæ˜¾ç¤ºaï¼ŒåŒæ—¶ç”¨1ä¸ªledç¯æ˜¾ç¤ºaæ˜¯å¦ä¸ºäºŒçš„å¹‚çš„åˆ¤æ–­ã€‚
2. **Case 1** è¾“å…¥æµ‹è¯•æ•°aï¼Œè¾“å…¥å®Œæ¯•ååœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºaï¼ŒåŒæ—¶ç”¨1ä¸ªledç¯æ˜¾ç¤ºaæ˜¯å¦ä¸ºå¥‡æ•°çš„åˆ¤æ–­ã€‚
3. **Case 2** å…ˆæ‰§è¡ŒCase 7, å†è®¡ç®— a å’Œ bçš„æŒ‰ä½æˆ–è¿ç®—ï¼Œå°†ç»“æœæ˜¾ç¤ºåœ¨è¾“å‡ºè®¾å¤‡ã€‚
4. **Case 3** å…ˆæ‰§è¡ŒCase 7, å†è®¡ç®— a å’Œ bçš„æŒ‰ä½æˆ–éè¿ç®—ï¼Œå°†ç»“æœæ˜¾ç¤ºåœ¨è¾“å‡ºè®¾å¤‡ã€‚
5. **Case 4** å…ˆæ‰§è¡ŒCase 7, å†è®¡ç®— a å’Œ bçš„æŒ‰ä½å¼‚æˆ–è¿ç®—ï¼Œå°†ç»“æœæ˜¾ç¤ºåœ¨è¾“å‡ºè®¾å¤‡ã€‚
6. **Case 5** å…ˆæ‰§è¡ŒCase 7, å†è®¡ç®— a å’Œ bçš„æŒ‰ä½æˆ–è¿ç®—ï¼Œå†æ‰§è¡Œ slt æŒ‡ä»¤ï¼Œå°†aå’ŒbæŒ‰ç…§æœ‰ç¬¦å·æ•°è¿›è¡Œæ¯”è¾ƒï¼Œç”¨è¾“å‡ºè®¾å¤‡å±•ç¤ºa<bçš„å…³ç³»æ˜¯å¦æˆç«‹ã€‚
7. **Case 6** å…ˆæ‰§è¡ŒCase 7, å†è®¡ç®— a å’Œ bçš„æŒ‰ä½æˆ–è¿ç®—ï¼Œå†æ‰§è¡Œ sltu æŒ‡ä»¤ï¼Œå°†aå’ŒbæŒ‰ç…§æ— ç¬¦å·æ•°è¿›è¡Œæ¯”è¾ƒï¼Œç”¨è¾“å‡ºè®¾å¤‡å±•ç¤ºa<bçš„å…³ç³»æ˜¯å¦æˆç«‹ã€‚
8. **Case 7** è¾“å…¥æµ‹è¯•æ•°a, è¾“å…¥æµ‹è¯•æ•°bï¼Œåœ¨è¾“å‡ºè®¾å¤‡ä¸Šå±•ç¤ºaå’Œbçš„å€¼ã€‚éœ€è¦æäº¤ä¸¤æ¬¡è¾“å…¥æ•°å€¼ã€‚

### åœºæ™¯äºŒ

1. **Case 0** è¾“å…¥açš„æ•°å€¼ï¼ˆaè¢«çœ‹ä½œæœ‰ç¬¦å·æ•°ï¼‰ï¼Œè®¡ç®—1åˆ°açš„ç´¯åŠ å’Œï¼Œåœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºç´¯åŠ å’Œï¼ˆå¦‚æœaæ˜¯è´Ÿæ•°ï¼Œä»¥é—ªçƒçš„æ–¹å¼ç»™ä¸æç¤ºï¼‰ã€‚
2. **Case 1** è¾“å…¥açš„æ•°å€¼ï¼ˆaè¢«çœ‹ä½œæ— ç¬¦å·æ•°ï¼‰ï¼Œä»¥é€’å½’çš„æ–¹å¼è®¡ç®—1åˆ°açš„ç´¯åŠ å’Œï¼Œè®°å½•æœ¬æ¬¡å…¥æ ˆå’Œå‡ºæ ˆæ¬¡æ•°ï¼Œåœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºå…¥æ ˆå’Œå‡ºæ ˆçš„æ¬¡æ•°ä¹‹å’Œã€‚
3. **Case 2** è¾“å…¥açš„æ•°å€¼ï¼ˆaè¢«çœ‹ä½œæ— ç¬¦å·æ•°ï¼‰ï¼Œä»¥é€’å½’çš„æ–¹å¼è®¡ç®—1åˆ°açš„ç´¯åŠ å’Œï¼Œè®°å½•å…¥æ ˆå’Œå‡ºæ ˆçš„æ•°æ®ï¼Œåœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºå…¥æ ˆçš„å‚æ•°ï¼Œæ¯ä¸€ä¸ªå…¥æ ˆçš„å‚æ•°æ˜¾ç¤ºåœç•™2-3ç§’ã€‚
4. **Case 3** è¾“å…¥açš„æ•°å€¼ï¼ˆaè¢«çœ‹ä½œæ— ç¬¦å·æ•°ï¼‰ï¼Œä»¥é€’å½’çš„æ–¹å¼è®¡ç®—1åˆ°açš„ç´¯åŠ å’Œï¼Œè®°å½•å…¥æ ˆå’Œå‡ºæ ˆçš„æ•°æ®ï¼Œåœ¨è¾“å‡ºè®¾å¤‡ä¸Šæ˜¾ç¤ºå‡ºæ ˆçš„å‚æ•°ï¼Œæ¯ä¸€ä¸ªå‡ºæ ˆçš„å‚æ•°æ˜¾ç¤ºåœç•™2-3ç§’ã€‚
5. **Case 4** è¾“å…¥æµ‹è¯•æ•°aå’Œæµ‹è¯•æ•°bï¼Œå®ç°æœ‰ç¬¦å·æ•°ï¼ˆaï¼Œbä»¥åŠç›¸åŠ å’Œéƒ½æ˜¯8bitï¼Œå…¶ä¸­çš„æœ€é«˜bitè¢«è§†ä½œç¬¦å·ä½ï¼Œå¦‚æœç¬¦å·ä½ä¸º1ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥è´Ÿæ•°çš„è¡¥ç ï¼‰çš„åŠ æ³•ï¼Œå¹¶å¯¹æ˜¯å¦æº¢å‡ºè¿›è¡Œåˆ¤æ–­ï¼Œè¾“å‡ºè¿ç®—ç»“æœä»¥åŠæº¢å‡ºåˆ¤æ–­ã€‚
6. **Case 5** è¾“å…¥æµ‹è¯•æ•°aå’Œæµ‹è¯•æ•°bï¼Œå®ç°æœ‰ç¬¦å·æ•°ï¼ˆaï¼Œbä»¥åŠå·®å€¼éƒ½æ˜¯8bitï¼Œå…¶ä¸­çš„æœ€é«˜bitè¢«è§†ä½œç¬¦å·ä½ï¼Œå¦‚æœç¬¦å·ä½ä¸º1ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥è´Ÿæ•°çš„è¡¥ç ï¼‰çš„å‡æ³•ï¼Œå¹¶å¯¹æ˜¯å¦æº¢å‡ºè¿›è¡Œåˆ¤æ–­ï¼Œè¾“å‡ºè¿ç®—ç»“æœä»¥åŠæº¢å‡ºåˆ¤æ–­ã€‚
7. **Case 6** è¾“å…¥æµ‹è¯•æ•°aå’Œæµ‹è¯•æ•°bï¼Œå®ç°æœ‰ç¬¦å·æ•°ï¼ˆaï¼Œbéƒ½æ˜¯8bitï¼Œä¹˜ç§¯æ˜¯16bitï¼Œå…¶ä¸­çš„æœ€é«˜bitè¢«è§†ä½œç¬¦å·ä½ï¼Œå¦‚æœç¬¦å·ä½ä¸º1ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥è´Ÿæ•°çš„è¡¥ç ï¼‰çš„ä¹˜æ³•ï¼Œè¾“å‡ºä¹˜ç§¯ã€‚
8. **Case 7** è¾“å…¥æµ‹è¯•æ•°aå’Œæµ‹è¯•æ•°bï¼Œå®ç°æœ‰ç¬¦å·æ•°ï¼ˆaï¼Œbï¼Œå•†å’Œä½™æ•°éƒ½æ˜¯8bitï¼Œå…¶ä¸­çš„æœ€é«˜bitè¢«è§†ä½œç¬¦å·ä½ï¼Œå¦‚æœç¬¦å·ä½ä¸º1ï¼Œè¡¨ç¤ºçš„æ˜¯è¯¥è´Ÿæ•°çš„è¡¥ç ï¼‰çš„é™¤æ³•ï¼Œè¾“å‡ºå•†å’Œä½™æ•°ï¼ˆå•†å’Œä½™æ•°äº¤æ›¿æ˜¾ç¤ºï¼Œå„æŒç»­5ç§’ï¼‰ã€‚

## ç¤ºä¾‹

æƒ³äº†è§£æˆ‘ä»¬é¡¹ç›®å¦‚ä½•è¿è¡Œå’Œä½¿ç”¨çš„çš„ï¼Œè¯·å‚è€ƒ [æ¼”ç¤ºè§†é¢‘](www.google.com)ã€‚

## ç›¸å…³ä»“åº“

- [CS202_CPU_Project](https://github.com/lkpengcs/CS202_CPU_Project/tree/master) â€” ğŸ’Œ é«˜è´¨é‡å•å‘¨æœŸCPU
- [SUSTech-CS202_214-Computer_Organization-Project](https://github.com/2catycm/SUSTech-CS202_214-Computer_Organization-Project) â€” ğŸ’Œ è§„èŒƒæ¨¡æ¿CPU

## ç»´æŠ¤è€…

[@Kazawaryu](https://github.com/Kazawaryu)	[@é…·é…·çš„é˜¿æ¶µ](https://github.com/xzzxy0413)	[@houfm](https://github.com/houfm)

## å¦‚ä½•è´¡çŒ®

éå¸¸æ¬¢è¿ä½ çš„åŠ å…¥ï¼[æä¸€ä¸ª Issue](https://github.com/Kazawaryu/Simple_CPU_in_FPGA/issues) æˆ–è€…[æäº¤ä¸€ä¸ª Request](https://github.com/Kazawaryu/Simple_CPU_in_FPGA/pulls)ã€‚

å¦‚æœæ‚¨å–œæ¬¢æˆ‘ä»¬çš„é¡¹ç›®ï¼Œç»™æˆ‘ä»¬ä¸€ä¸ªâ­æ˜¯å¯¹æˆ‘ä»¬æœ€å¤§çš„æ”¯æŒã€‚

### è´¡çŒ®è€…

æ„Ÿè°¢ä»¥ä¸‹å‚ä¸é¡¹ç›®çš„äººï¼š
<a href="https://github.com/Kazawaryu/Simple_CPU_in_FPGA/graphs/contributors">
  <img src="https://contrib.rocks/image?repo=Kazawaryu/Simple_CPU_in_FPGA" />
</a>

## ä½¿ç”¨è®¸å¯

[MIT](LICENSE) Â© Kazawaryu

